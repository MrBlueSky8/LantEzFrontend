<div class="evaluacion-container">
  <!-- Cabecera -->
  <div class="evaluacion-header" *ngIf="puestoSeleccionado; else cargandoHeader">
    <img src="/assets/backIcon.svg" alt="Atrás" (click)="volverAtras()" class="icon-btn">
    <img src="/assets/editEvaluacionpuesto.svg" alt="Editar" (click)="editarEvaluacion()" class="icon-btn">
    <h2>Puesto: {{ puestoSeleccionado.nombre_puesto }}</h2>
  </div>

  <ng-template #cargandoHeader>
    <div class="evaluacion-header">
      <h2>Cargando puesto...</h2>
    </div>
  </ng-template>

  <!-- Contenedor principal -->
  <div class="contenido-principal">
    <!-- Lista de postulantes -->
    <div class="lista-postulantes">
      <div class="titulo-lista">
        <img src="/assets/postuladosIcon.svg" alt="Postulados">
        <span>{{ postulacionesVisibles.length }} evaluados</span>
      </div>

      <div 
        class="postulante-card" 
        *ngFor="let postulacion of postulacionesVisibles" 
        [class.seleccionado]="postulacion.id === postulacionSeleccionada?.id"
        (click)="seleccionarPostulante(postulacion)">
        <img [src]="postulacion.postulante.foto_url" alt="{{ postulacion.postulante.primer_nombre }}" class="foto-postulante" (error)="postulacion.postulante.foto_url='/assets/defaultUser.svg'">
        <div class="info-postulante">
          <span>{{ postulacion.postulante.apellido_p }}, {{ postulacion.postulante.primer_nombre }}</span>
          <span>{{ postulacion.postulante.fechanacimiento | age }} años - {{ postulacion.porcentaje_compatibilidad | number:'1.0-0' }}%</span>
        </div>
      </div>
    </div>

    <!-- Espacio para detalle futuro -->
    <div class="detalle-postulante" *ngIf="postulacionSeleccionada; else seleccionaPostulante">
    <div class="detalle-header">
      <div class="detalle-postulante-info">
        <img [src]="postulacionSeleccionada.postulante.foto_url" 
            alt="{{ postulacionSeleccionada.postulante.primer_nombre }}" 
            class="foto-detalle" 
            (error)="postulacionSeleccionada.postulante.foto_url='/assets/defaultUser.svg'">
        
        <div class="info-postulante-detalle">
          <h3>{{ postulacionSeleccionada.postulante.apellido_p }}, {{ postulacionSeleccionada.postulante.primer_nombre }}</h3>
          <div class="info-detalle-grid">
            <p class="linea-info">
              <span class="etiqueta">Edad:</span>
              <span class="contenido-label">{{ postulacionSeleccionada.postulante.fechanacimiento | age }} años</span>
            </p>
            <p class="linea-info">
              <span class="etiqueta">Género:</span>
              <span class="contenido-label">{{ postulacionSeleccionada.postulante.genero }}</span>
            </p>
            <p class="linea-info">
              <span class="etiqueta">Ciudad:</span>
              <span class="contenido-label">{{ postulacionSeleccionada.postulante.ciudades.ciudad }}</span>
            </p>
            <!-- Puedes agregar más campos si deseas mantener simetría -->
          </div>
        </div>
      </div>

      <div class="detalle-postulacion-estado">
        <img src="/assets/refresh.svg" alt="Refresh" class="refresh-icon" (click)="refrescarCruce()">
        <span [ngClass]="postulacionSeleccionada.estado_postulacion">{{ postulacionSeleccionada.estado_postulacion | uppercase }}</span>
        <span class="compatibilidad-general">{{ postulacionSeleccionada.porcentaje_compatibilidad | number:'1.0-0' }}%</span>
      </div>
    </div>
    <div class="tabla-container" *ngIf="!cargandoCompetencias">
      <table class="tabla-competencias">
        <thead>
          <tr>
            <th class="th-competencia">Competencias</th>
            <th class="th-nivel">NIVEL DEL PUESTO</th>
            <th class="th-coincidencia">COINCIDENCIA</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of competenciasDetalle">
            <td>{{ c.competencia }}</td>
            <td>{{ c.nivelPuesto }}</td>
            <td>{{ c.coincidencia }}%</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="loading-tabla" *ngIf="cargandoCompetencias">
      Cargando competencias…
    </div>
    <div class="solicitar-análisis">
      <button mat-raised-button color="primary" (click)="solicitarAnalisis()">
        SOLICITAR ANÁLISIS
      </button>
    </div>
  </div>

  <ng-template #seleccionaPostulante>
    <div class="detalle-postulante">
      <div style="margin: auto; text-align: center; color: #888; font-size: 16px;">
        Selecciona un postulante para ver el detalle.
      </div>
    </div>
  </ng-template>
  </div>
</div>
